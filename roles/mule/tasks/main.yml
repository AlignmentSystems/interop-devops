# Ansible playbook for deploying the
# ilp-connector, ilp-spsp-client-rest, and ilp-spsp-server
# to the L1P test integration environment

# Note this must be run with the CLI param --extra-vars="docker_username=... docker_password=... docker_email=..."
---

- include_vars:
    file: versions/{{ env }}/modusboxversions.yml

- name: Start dfsp-scheme-adapter
  become: true
  docker_container:
    name: dfsp-scheme-adapter
    image: "mojaloop/dfsp-scheme-adapter:{{ v_dfsp_scheme_adapter }}"
    restart_policy: always
    state: started
    networks:
      - name: MOJALOOP_NET
    restart: yes
    log_driver: syslog
    log_options: 
      syslog-address: 'tcp://{{ log_ip }}:514'
      syslog-facility: daemon
      tag: dfsp-scheme-adapter
    ports:
      - "8088:8088"
    env:
      MOJALOOP_HOST: '{{ switch_host }}'
      MOJALOOP_PORT: '8088'
      DFSP_HOST: 'localhost'
      DFSP_API_PORT: '8010'
      DFSP_LEDGER_PORT: '8014'
      MAX_JVM_MEMORY: '256'
      DFSP_SCHEME_ADAPTER_HOST: '0.0.0.0'
      DFSP_SCHEME_ADAPTER_PORT: '8088'
      DFSP_SCHEME_ADAPTER_HTTPS_PORT: '443'
      DFSP_ENVIRONMENT: '{{ inventory_hostname }}-test'
